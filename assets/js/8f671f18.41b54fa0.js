"use strict";(self.webpackChunkdocs_garz_dev=self.webpackChunkdocs_garz_dev||[]).push([[6570],{5728:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>l,contentTitle:()=>t,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>c});var i=s(4848),o=s(8453);const r={},t="Dynamic host configuration",a={id:"os/cisco/dynamic-config",title:"Dynamic host configuration",description:"Configuring dynamic host configuration (DHCP and SLAAC) on a Cisco device.",source:"@site/docs/os/cisco/060_dynamic-config.md",sourceDirName:"os/cisco",slug:"/os/cisco/dynamic-config",permalink:"/os/cisco/dynamic-config",draft:!1,unlisted:!1,editUrl:"https://github.com/garzj/docs-diary/edit/master/docs/os/cisco/060_dynamic-config.md",tags:[],version:"current",lastUpdatedBy:"garzj",sidebarPosition:60,frontMatter:{},sidebar:"autoSidebar",previous:{title:"Spanning tree",permalink:"/os/cisco/spanning-tree"},next:{title:"Redundancy",permalink:"/os/cisco/redundancy"}},l={},c=[{value:"DHCP",id:"dhcp",level:2},{value:"DHCP messages",id:"dhcp-messages",level:3},{value:"Configuration",id:"configuration",level:3},{value:"Evaluation",id:"evaluation",level:3},{value:"ICMPv6 (SLAAC / DHCPv6)",id:"icmpv6-slaac--dhcpv6",level:2},{value:"Terminology",id:"terminology",level:3},{value:"Common ICMPv6 messages",id:"common-icmpv6-messages",level:3},{value:"DHCPv6 messages",id:"dhcpv6-messages",level:3},{value:"Configuration",id:"configuration-1",level:3},{value:"Minimal router config",id:"minimal-router-config",level:4},{value:"More router config",id:"more-router-config",level:4},{value:"Host configuration",id:"host-configuration",level:4},{value:"Evaluation",id:"evaluation-1",level:3},{value:"DHCPv6 relay agents",id:"dhcpv6-relay-agents",level:3}];function d(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h1,{id:"dynamic-host-configuration",children:"Dynamic host configuration"}),"\n",(0,i.jsx)(e.p,{children:"Configuring dynamic host configuration (DHCP and SLAAC) on a Cisco device."}),"\n",(0,i.jsx)(e.h2,{id:"dhcp",children:"DHCP"}),"\n",(0,i.jsx)(e.p,{children:"DHCP stands for Dynamic Host Configuration Protocol."}),"\n",(0,i.jsx)(e.h3,{id:"dhcp-messages",children:"DHCP messages"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"DHCPDISCOVER"}),": trigger available servers to send an offer (broadcast)"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"DHCPOFFER"}),": respond with an offer holding the config (uni-/broadcast)"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"DHCPREQUEST"}),": request to use the offer / renew the lease / inform other servers (broadcast)"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"DHCPACK"}),": acknowledge the lease (uni-/broadcast)"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-cisco-ios",children:"! Exclude ranges from all pools (low- and high address)\nip dhcp excluded-address 192.168.0.1\nip dhcp excluded-address 192.168.0.200 192.168.0.255\n\n! Create a pool\nip dhcp pool PRODUCTION\n  network 192.168.0.0 255.255.255.0\n  default-router 192.168.0.1\n  dns-server 192.168.11.5\n  domain-name example.com\n  ! lease <days>\n  lease 7\n"})}),"\n",(0,i.jsx)(e.h3,{id:"evaluation",children:"Evaluation"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-cisco-ios",metastring:'title="#"',children:"show running-config | section dhcp\nshow ip dhcp binding\nshow ip dhcp server statistics\n"})}),"\n",(0,i.jsx)(e.h2,{id:"icmpv6-slaac--dhcpv6",children:"ICMPv6 (SLAAC / DHCPv6)"}),"\n",(0,i.jsx)(e.p,{children:"SLAAC stands for StateLess Address Auto Configuration."}),"\n",(0,i.jsx)(e.p,{children:"It can optionally work together with a DHCPv6 server."}),"\n",(0,i.jsxs)(e.p,{children:["If both SLAAC and DHCPv6 address config are enabled, ",(0,i.jsx)(e.strong,{children:"a host can have multiple IPv6 addresses"}),"."]}),"\n",(0,i.jsx)(e.h3,{id:"terminology",children:"Terminology"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"link-local address"}),": an IPv6 address used for local communication"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"network prefix"}),": usually the first 64 bits of a 128 bit IPv6 address"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"GUA"}),": a globally unique address"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"DAD"}),": duplicate address detection (is performed after GUA configuration)"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"common-icmpv6-messages",children:"Common ICMPv6 messages"}),"\n",(0,i.jsx)(e.p,{children:"ICMPv6 stands for Internet Control Message Protocol and is also used for IPv6 address configuration."}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Router Solicitation (RS)"}),": ask routers to send RA (multicast to all routers using ",(0,i.jsx)(e.code,{children:"ff02::2"}),")"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Router Advertisement (RA)"}),": carries the following data (multicast to all nodes using ",(0,i.jsx)(e.code,{children:"ff02::1"}),")","\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"router's link local"}),"\n",(0,i.jsx)(e.li,{children:"network prefix information"}),"\n",(0,i.jsxs)(e.li,{children:["config flags","\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"A (autonomous)"}),": hosts should use the network prefix to create their own GUA (stateless)"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"O (other)"}),": hosts should use DHCPv6 for non-address configuration (DNS, NTP, etc.)"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"M (managed)"}),": hosts should use DHCPv6 for address configuration (stateful) AND config from the O flag"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Neighbor Solicitation (NS)"}),": find MAC addresses of other hosts (like ARP)"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Neighbor Solicitation (NA)"}),": respond to NS messages or notify about address changes"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"dhcpv6-messages",children:"DHCPv6 messages"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"SOLICIT"}),": trigger DHCPv6 servers to send an advertisement (multicast to all routers)"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"ADVERTISE"}),": inform the host about the server"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"REQUEST"}),": request a lease from the server (",(0,i.jsx)(e.strong,{children:"INFORMATION-REQUEST"})," when stateless)"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"REPLY"}),": server replying with the data"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"configuration-1",children:"Configuration"}),"\n",(0,i.jsx)(e.h4,{id:"minimal-router-config",children:"Minimal router config"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-cisco-ios",children:"! Make sure routing is enabled to emit RA messages\nipv6 unicast-routing\n\ninterface gi0/0\n  no shutdown\n\n  ! enables SLAAC by default\n  ipv6 address 2001:db8:acad:1::1/64\n\n  ! this should work too to enable SLAAC, but sometimes just doesn't on Cisco Packet Tracer\n  ipv6 address autoconfig\n\n  ! Typically not needed on newer devices\n  ipv6 enable\n"})}),"\n",(0,i.jsx)(e.h4,{id:"more-router-config",children:"More router config"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-cisco-ios",children:"! Create a DHCPv6 pool\nip dhcp pool LA_PISCINA\n  ! O and M flags\n  dns-server 2001:db8:acad:ffff::254\n  domain-name example.com\n\n  ! only M flag\n  address prefix 2001:db8:acad:2::/64\n\ninterface gi0/0\n  ! change the link-local address\n  ipv6 fe80::1 link-local\n\n  ! Configure dhcp pool to retrieve the info specified by flags\n  ipv6 dhcp server LA_PISCINA\n\n  ! set the O flag (stateless)\n  ipv6 nd other-config-flag\n\n  ! set the M flag (stateful)\n  ipv6 nd managed-config-flag\n"})}),"\n",(0,i.jsx)(e.h4,{id:"host-configuration",children:"Host configuration"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-cisco-ios",children:"interface gi0/0\n  description LAN interface\n  no shutdown\n\n  ! Stateless\n  ipv6 address autoconfig\n\n  ! Stateful\n  ipv6 address dhcp\n  ! Disable SLAAC or both are used\n  ipv6 nd prefix default no-autoconfig\n"})}),"\n",(0,i.jsx)(e.h3,{id:"evaluation-1",children:"Evaluation"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-cisco-ios",metastring:'title="#"',children:"show ipv6 interface brief\nshow ipv6 neighbors\n\n! DHCPv6\nshow ipv6 dhcp pool\nshow ipv6 dhcp binding\n"})}),"\n",(0,i.jsx)(e.h3,{id:"dhcpv6-relay-agents",children:"DHCPv6 relay agents"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-cisco-ios",metastring:'title="config-if#"',children:"! Relays DHCPv6 traffic for this server to another\n! Does not work in Cisco Packet Tracer yet\nipv6 dhcp relay destination 2001:db8:acad:adb::1\n"})})]})}function h(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(d,{...n})}):d(n)}},8453:(n,e,s)=>{s.d(e,{R:()=>t,x:()=>a});var i=s(6540);const o={},r=i.createContext(o);function t(n){const e=i.useContext(r);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:t(n.components),i.createElement(r.Provider,{value:e},n.children)}}}]);